{% extends "base/base.html" %}
{% load static %}

{% block content %}
    <h2>Wishlist</h2>
    {% if wishlist_items %}
        <table class="table">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in wishlist_items %}
                    <tr>
                        <td><img src="{{ item.product.image.url }}" alt="{{ item.product.title }}" width="50"></td>
                        <td>{{ item.product.title }}</td>
                        <td>${{ item.product.price }}</td>
                        <td>
                            <button class="btn btn-danger" onclick="removeFromWishlist('{{ item.id }}')">Remove</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Your wishlist is empty.</p>
    {% endif %}

    <script>
        function removeFromWishlist(itemId) {
            fetch(`/remove_from_wishlist/${itemId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => {
                if (response.ok) {
                    // Item removed successfully
                    // You can update the UI or perform any other actions here
                    window.location.reload(); // Reload the page to reflect changes
                } else {
                    // Handle error
                    console.error('Failed to remove item from wishlist');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Handle error
            });
        }
    </script>
{% endblock %}
